# Terminal Simulator

> Source: `src/simulator/engine.ts`, `renderer.ts`, `scenarios/*.ts`

## Architecture

```
Scenario (data) → SimulatorEngine (timing) → TerminalRenderer (DOM)
```

## Scenario Format

```typescript
interface Scenario {
  id: ScenarioId;        // 'git' | 'python' | 'logs' | ... | 'all'
  title: string;
  prompt: string;        // e.g. '❯'
  windowTitle: string;
  commands: ScenarioCommand[];
}

interface ScenarioCommand {
  text: string;          // Command text typed char-by-char
  typeSpeed?: number;    // ms per char (default 50)
  events: ScenarioEvent[];
}

interface ScenarioEvent {
  type: 'output' | 'clear' | 'pause';
  text?: string;                          // Plain text line
  tokens?: { text: string; class?: string }[];  // Colored segments
  delay: number;                          // ms before this event
}
```

## Available Scenarios

`all`, `git`, `python`, `logs`, `system`, `docker`, `files`, `build`, `ssh`

The `all` scenario is auto-generated by flatMapping all individual scenario commands.

## Engine (`SimulatorEngine`)

- **Flattens** scenario into linear steps: `prompt → char → char → ... → post-type-pause → finish-command → output-line → output-line → ...`
- **`setTimeout` chains**: Each step schedules the next with speed-adjusted delay
- **Speed scaling**: `actualDelay = step.delay / speed`
- **Speed change mid-animation**: Cancels current timeout, recalculates remaining time at new speed
- **Speed 0 = pause**: Calls `pause()`, resumes on non-zero speed
- **Looping**: On completion, waits 2s then restarts from step 0 with `onClear`
- **Non-looping**: Fires `onComplete`, renderer shows idle blinking cursor

## Renderer (`TerminalRenderer`)

- Creates `div.terminal-output` container
- **Prompt**: `div.terminal-line > span.terminal-prompt + span.terminal-command + span.terminal-cursor-char`
- **Typing**: Appends chars to `.terminal-command` span
- **Output**: Creates `div.terminal-line` with optional colored `span` tokens
- **Token classes**: Map to CSS variables (e.g. `class="ansi-red"` → `color: var(--theme-red)`)
- **Auto-scroll**: Scrolls to bottom when near bottom edge

## Adding a New Scenario

1. Create `src/simulator/scenarios/my-scenario.ts`
2. Export a `Scenario` object
3. Import in `scenarios/index.ts` and add to `individualScenarios` array + `scenarios` Record
4. Add the scenario ID to `ScenarioId` type (in `scenarios/index.ts` and `store/store.ts`)
